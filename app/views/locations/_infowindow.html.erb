<!-- Wrapper -->
<div id="location_infowindow">

<!-- Types -->
<div id="type_list">
 <% @location.locations_types.each{ |d| %>
 <li>
 <%= d.name.nil? ? "Unknown" : d.name %>
 <% unless d.type.nil? %>
	 <% unless d.type.wikipedia_url.blank? %>
		<a href="<%= d.type.wikipedia_url %>" target="_blank"><img class="type_icon" src="/wikipedia_icon.png"></a>
	 <% end %>
	 <% unless d.type.usda_symbol.blank? %>
		<a href="http://plants.usda.gov/java/profile?symbol=<%= d.type.usda_symbol %>" target="_blank"><img class="type_icon" src="/usda_icon.png"></a>
	 <% end %>
 <% end %>
 </li>
 <% } %>
</div>

<!-- Description wrapper -->
<div id="description">

<!-- Quality -->
<% unless location.quality_rating.blank? %>
	<% ratings = "true" %>
 	<label>Quality</label> "<%= Location::Ratings[location.quality_rating] %>"
<% end %>

<!-- Yield -->
<% unless location.yield_rating.blank? %>
	<% ratings = "true" %>
	<label>Yield</label> "<%= Location::Ratings[location.yield_rating] %>"
<% end %>
<% unless ratings.nil? %>
	<br/>
<% end %>

<!-- Season -->
<!-- (use ? to denote nil, brown out of season, green in season) -->
<% unless location.no_season or (location.season_start.nil? and location.season_stop.nil?) %>
	<label>Season</label>
 <% current = Date.today.month.to_i - 1 
    season_class = "out_season"
    season_class = "in_season" if (current == location.season_start) or (current == location.season_stop)
    season_class = "in_season" if (!location.season_start.nil? and !location.season_stop.nil? and 
                                  current >= location.season_start and current <= location.season_stop)
    pretty_stop = location.season_stop.nil? ? "?" : Location::Months[location.season_stop]
    pretty_start = location.season_start.nil? ? "?" : Location::Months[location.season_start]
  %>
  <span class="<%= season_class %>">
  <% unless pretty_start == pretty_stop %>
  	<%= pretty_start %> - <%= pretty_stop %>
  <% else %>
  	<%= pretty_start %>
	<% end %>
  </span><br/>
<% end %>
 
<!-- Text Description -->
<!-- (keep <p> markup even if empty) -->
<p>
<% unless location.description.blank? %>
 <%= sanitize(location.description.strip.gsub(/\n/,"<br>"),tags:["br"]) %>
<% end %>
</p>
<% unless location.access.nil? %>
<p><span style="font-style: italic; color: #a9a9a9;"><%= Location::AccessStatements[location.access] %></span></p>
<% end %>

</div>  <!-- Description wrapper -->

<!-- Controls & Author -->
<!-- (using table instead of display: table-cell for compatibility with IE <= 7) -->
<!-- FIXED? div width=100% needed to match footer to window size so that wrapping does not introduce scroll bar -->
<!--<div style="width:100%;">-->
<table id="footer">
	<tr>
 		<td id="controls">
 		<a href="javascript:zoom_to_marker();" data-ajax="false">zoom</a>
 		<a href="/locations/<%= location.id %>" data-ajax="false" rel="external" id="location_link" onclick="update_url('#location_link'); return false;">link</a><a href="/locations/<%= location.id %>/edit" data-ajax="false" rel="external">edit</a>
 		<% if !mobile_device? and user_signed_in? and current_user.is? :admin %>
 			<a href="javascript:toggle_route_controls();" data-ajax="false">routes <img src="/smarrow_down.png" /></a>
 		<% end %>
 		<% if user_signed_in? and current_user.is? :admin %>
  		<%= link_to('delete', location, method: :delete, data: { confirm: 'Are you sure?' }) %>
 		<% end %>
 		</td>
  	<td id="added_by">by <i><%= (location.author.nil? or (location.author.strip.length == 0)) ? "Anonymous" : location.author %></i></td>
 	</tr>
</table>

<!-- Routes -->
<% if !mobile_device? and user_signed_in? %>
<div id="route_controls" style="display:none;">
<hr style="border-top:1px solid #ddd;margin:1em 0;">
Routes: 
<form style="display: inline;" action="/locations/<%= location.id %>/enroute" method="get">
	<select id="route_id" name="route_id">
		<% Route.where("user_id = ?",current_user.id).each do |r| %>
 			<option value="<%= r.id %>"><%= r.name %> <%= LocationsRoute.where("route_id = ? AND location_id = ?",r.id,location.id).count > 0 ? "(+)" : "" %></option>
		<% end %>
 		<option value="-1">-- New Route --</option>
	</select>
	<input type="submit" value="+ / -" style="padding:0.05em 0.25em;">
</form>
<% end %>
</div>
<!--<div style="width:100%;">-->

</div>  <!-- Wrapper -->