<!-- Source Form -->
<%= form_for(problem,:html => {:id=>"problemform",:onsubmit=>"process_form();return false;"}) do |f| %>

  <!-- Errors -->
  <% if problem.errors.any? %>
    <div id="error_explanation">
      <strong><%= pluralize(problem.errors.count, "error") %> prohibited this issue from being saved:</strong>
        <ul>
      <% problem.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <%= f.hidden_field :id %>
  <%= f.hidden_field :location_id %>

	<!-- Problem -->
	<!-- FIXME: Translate problem code -->
  <div class="field first">
    <%= f.label :problem_type, I18n.t("problems.problem_type") %><br />
    <%= f.select(:problem_code, Problem::Codes.collect{ |r| [r,Problem::Codes.index(r)] }, :include_blank => true) %>
  </div>

	<!-- Explanation -->
  <div class="field">
    <%= f.label :description, I18n.t("locations.form.description") %><br />
    <span class="subtext"><%= I18n.t("problems.description_subtext") %></span><br />
    <%= f.text_area(:comment) %>
  </div>
  
  <% unless user_signed_in? %>
  	<!-- Contact info -->
    <div class="field">
   		<%= f.label :your_contact_info, I18n.t("problems.your_contact_info") %><br />
   		<%= f.text_field(:name, :placeholder => I18n.t("devise.fallingfruit.name")) %><br />
   		<div style="margin-top:0.25em;"><%= f.text_field(:email, :placeholder =>  I18n.t("devise.fallingfruit.email")) %></div>
  	</div>

   	<br />
  	<!-- Captcha -->
  	<div id="captcha"></div>
  	<script type="text/javascript">
  			show_recaptcha("captcha");
		</script>
  <% end %>
  
  <br />
  <!-- Submit -->
  <div class="actions">
    <%= f.submit "Submit" %>
  </div>
  
<% end %>
</form>

<script type="text/javascript">
function process_form(){
  $.ajax({
    type: 'POST',
    url: '/problems',
    data: $("#problemform").serialize(),
    success: function(data){
      $("#problem_modal").html(data);
    }
  });
}
</script>
