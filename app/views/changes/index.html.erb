<p>
<b><%= I18n.t("changes.index.recent_changes") %></b>
</p>

<% 
last_days_ago = nil 
@changes.each do |c|
  types = c["type_title"]
  unless c["country"].nil?
    city = [c["city"],c["state"],c["country"]].compact.join(", ")
  end
  case c["description"]
    when "added"
      action = I18n.t("changes.type.added")
    when "edited"
      action = I18n.t("changes.type.edited")
    when "visited"
      action = I18n.t("changes.type.visited")
  end
  c["days_ago"] = c["days_ago"].to_i
  if last_days_ago.nil? or c["days_ago"] > last_days_ago
    if c["days_ago"] <= 0
      header = I18n.t("changes.index.last_24_hours")
    else
      if c["days_ago"] == 1
        header = I18n.t("changes.index.1_day_ago")
      else
        header = I18n.t("changes.index.n_days_ago",:n => c["days_ago"])
      end
    end
    if last_days_ago.nil? 
      header = header + "<blockquote>"
    else
      header = "</blockquote>#{header}<blockquote>"
    end
    last_days_ago = c["days_ago"]
  end
%>
<%= raw header %>
<% unless c["location_id"].nil? %>
  <%= link_to location_path(c["location_id"]) do %>
    <%= types.nil? ? I18n.t("locations.sidebar.unknown") : types %>
  <% end %>
  (#<%= c["location_id"] %>)
  <% unless city.nil? %>
    <%= I18n.t("changes.index.change_in_city", :type => action, :city => city) %>
  <% else %>
    <%= action %>
  <% end %>
  <% if user_signed_in? and current_user.is? :admin %>
    &middot; <span style="color: #E35809;">
    <% if c["user_id"].nil? %>
      <%= c["remote_ip"] %>
    <% else %>
      <%= I18n.t("changes.index.user") %> #<%= c["user_id"] %>
    <% end %>
    </span>
  <% end %>
  <br>
<% end %>
<% end %>
<% if @changes.length > 0 %>
  </blockquote>
<% end %>
